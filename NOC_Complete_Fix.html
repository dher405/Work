<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOC Complete Calendar Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">ðŸ”§ NOC Complete Calendar Fix</h1>
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                <p class="text-sm text-blue-800"><strong>This tool will:</strong></p>
                <ul class="list-disc ml-5 mt-2 text-sm text-blue-700">
                    <li>Remove ALL assignments where engineers are on their day off</li>
                    <li>Regenerate the entire calendar respecting days off</li>
                    <li>Show you exactly what was fixed</li>
                </ul>
            </div>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">GitHub Username:</label>
                    <input type="text" id="githubUsername" value="dher405" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Repository Name:</label>
                    <input type="text" id="githubRepo" value="Work" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Personal Access Token:</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Branch:</label>
                    <input type="text" id="githubBranch" value="main" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
            </div>

            <button onclick="fixCalendar()" class="w-full bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 font-semibold mb-4">
                ðŸš€ Fix Entire Calendar
            </button>
            
            <div id="progress" class="hidden mb-4"></div>
            <div id="results" class="hidden mb-4"></div>
            <div id="status" class="mt-4"></div>
        </div>
    </div>

    <script>
const DEFAULT_ENGINEERS=[{name:"Alexandra Hock",email:"alexandra.hock@ringcentral.com",schedule:{sun:"OFF",mon:"05:00-14:00",tue:"05:00-14:00",wed:"05:00-14:00",thu:"05:00-14:00",fri:"05:00-14:00",sat:"OFF"},shift:"early"},{name:"Marina Stambaugh",email:"marina.stambaugh@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Rochelle Gobis",email:"rochelle.gobis@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"OFF"},shift:"day"},{name:"Sarah Heriford",email:"sarah.heriford@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Karla Talamantes",email:"karla.talamantes@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Jeremy Rodriguez",email:"jeremyr@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Jenny Deasy",email:"jenny.deasy@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-15:30",tue:"07:00-15:30",wed:"07:00-15:30",thu:"07:00-15:30",fri:"07:00-15:30",sat:"OFF"},shift:"early"},{name:"Bo Lemecha",email:"Bo.Lemecha@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-14:30",tue:"06:00-14:30",wed:"06:00-14:30",thu:"06:00-14:30",fri:"06:00-14:30",sat:"OFF"},shift:"early"},{name:"Edwin Reveley",email:"edwin.reveley@ringcentral.com",schedule:{sun:"OFF",mon:"09:30-18:00",tue:"09:30-18:00",wed:"09:30-18:00",thu:"09:30-18:00",fri:"09:30-18:00",sat:"OFF"},shift:"day"},{name:"Edward Salvador",email:"edward.salvador@ringcentral.com",schedule:{sun:"08:00-15:30",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"OFF",sat:"OFF"},shift:"day"},{name:"John Glenn Bayron",email:"john.bayron@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"OFF"},shift:"day"},{name:"Robert Carter",email:"robert.carter@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-17:00",tue:"09:00-17:00",wed:"09:00-17:00",thu:"09:00-17:00",fri:"09:00-17:00",sat:"OFF"},shift:"day"},{name:"Dan Baker",email:"dan.baker1@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-15:00",tue:"07:00-15:00",wed:"07:00-15:00",thu:"07:00-15:00",fri:"07:00-15:00",sat:"OFF"},shift:"early"},{name:"John Tran",email:"john.tran@ringcentral.com",schedule:{sun:"OFF",mon:"10:00-18:00",tue:"10:00-18:00",wed:"10:00-18:00",thu:"10:00-18:00",fri:"10:00-18:00",sat:"OFF"},shift:"day"},{name:"Jared Cooper",email:"jared.cooper@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Lara Mae Dela Cruz",email:"lara.delacruz@ringcentral.com",schedule:{sun:"OFF",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"15:00-00:00",fri:"15:00-00:00",sat:"OFF"},shift:"evening"},{name:"Love Lyn Cano",email:"love.cano@ringcentral.com",schedule:{sun:"15:00-00:00",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"OFF",fri:"OFF",sat:"15:00-00:00"},shift:"evening"},{name:"James Belleza",email:"james.belleza@ringcentral.com",schedule:{sun:"15:00-00:00",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"15:00-00:00",fri:"OFF",sat:"OFF"},shift:"evening"},{name:"Rushikesh Sawant",email:"rushikesh.sawant@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Santosh Sahoo",email:"santosh.sahoo@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Srikanth Reddy",email:"srikanth.v@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Jobon Chinel",email:"jobon.chinel@ringcentral.com",schedule:{sun:"01:00-10:00",mon:"01:00-10:00",tue:"01:00-10:00",wed:"01:00-10:00",thu:"01:00-10:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Ryan Hawkins",email:"ryan.hawkins@ringcentral.com",schedule:{sun:"01:00-07:00",mon:"01:00-07:00",tue:"01:00-07:00",wed:"01:00-07:00",thu:"01:00-07:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Joseph Bendecio",email:"joseph.bendecio@ringcentral.com",schedule:{sun:"OFF",mon:"OFF",tue:"01:00-10:00",wed:"01:00-10:00",thu:"01:00-10:00",fri:"01:00-10:00",sat:"01:00-10:00"},shift:"night"},{name:"Pearce Hamblin",email:"pearce.hamblin@ringcentral.com",schedule:{sun:"01:00-07:00",mon:"01:00-07:00",tue:"01:00-07:00",wed:"01:00-07:00",thu:"01:00-07:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Amine Dahel",email:"amine.dahel@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Andrew Neill",email:"andrew.neill@ringcentral.com",schedule:{sun:"03:00-09:00",mon:"03:00-09:00",tue:"03:00-09:00",wed:"03:00-09:00",thu:"03:00-09:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Andy Connolly",email:"andy.connolly@ringcentral.com",schedule:{sun:"03:00-09:00",mon:"03:00-09:00",tue:"03:00-09:00",wed:"03:00-09:00",thu:"03:00-09:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Colin Finn",email:"colin.finn@ringcentral.com",schedule:{sun:"02:00-08:00",mon:"02:00-08:00",tue:"02:00-08:00",wed:"02:00-08:00",thu:"02:00-08:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Deepthi Chandran",email:"deepthi.chandran@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Derek Walker",email:"derek.walker@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Hugo Nickal-Thibeaud",email:"hugo.thibeaud@ringcentral.com",schedule:{sun:"02:00-08:00",mon:"02:00-08:00",tue:"02:00-08:00",wed:"02:00-08:00",thu:"02:00-08:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Baranee Selvendran",email:"baranee.selvendran@ringcentral.com",schedule:{sun:"02:00-10:00",mon:"02:00-10:00",tue:"02:00-10:00",wed:"02:00-10:00",thu:"02:00-10:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Eryll Azucena",email:"eryll.azucena@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"08:00-15:30"},shift:"day"},{name:"Mare Snyder",email:"mare.snyder@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Nate Malone",email:"nate.malone@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Peter Czarnecki",email:"peter.czarnecki@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-14:30",tue:"06:00-14:30",wed:"06:00-14:30",thu:"06:00-14:30",fri:"06:00-14:30",sat:"OFF"},shift:"early"},{name:"Colby Jestes",email:"colby.jestes@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Mark Peirce",email:"mark.peirce@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Roscoe Bryant",email:"roscoe.bryant@ringcentral.com",schedule:{sun:"OFF",mon:"08:30-17:00",tue:"08:30-17:00",wed:"08:30-17:00",thu:"08:30-17:00",fri:"08:30-17:00",sat:"OFF"},shift:"day"},{name:"Cindy Hubert",email:"cindy.hubert@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Abby Bearden",email:"abby.bearden@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-15:00",tue:"06:00-15:00",wed:"06:00-15:00",thu:"06:00-15:00",fri:"06:00-15:00",sat:"OFF"},shift:"early"},{name:"Tim Arnott",email:"tim.arnott@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-15:00",tue:"06:00-15:00",wed:"06:00-15:00",thu:"06:00-15:00",fri:"06:00-15:00",sat:"OFF"},shift:"early"},{name:"Tomislav Vranjes",email:"tomislav.vranjes@ringcentral.com",schedule:{sun:"OFF",mon:"09:30-18:00",tue:"09:30-18:00",wed:"09:30-18:00",thu:"09:30-18:00",fri:"09:30-18:00",sat:"OFF"},shift:"day"}];

let config = {username: "", repo: "", token: "", branch: "main"};
let fileSha = "";
let calendarData = null;

function isWorking(engineer, dayOfWeek) {
    const dayNames = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
    const daySchedule = engineer.schedule[dayNames[dayOfWeek]];
    return daySchedule !== "OFF";
}

function showProgress(message) {
    const progressDiv = document.getElementById("progress");
    progressDiv.classList.remove("hidden");
    progressDiv.className = "p-4 bg-blue-50 border-l-4 border-blue-400 rounded";
    progressDiv.textContent = message;
}

function showStatus(message, type) {
    const statusDiv = document.getElementById("status");
    const colors = {
        success: "bg-green-50 text-green-800 border-green-200",
        error: "bg-red-50 text-red-800 border-red-200",
        warning: "bg-yellow-50 text-yellow-800 border-yellow-200",
        info: "bg-blue-50 text-blue-800 border-blue-200"
    };
    statusDiv.className = `p-4 rounded-lg border ${colors[type]}`;
    statusDiv.textContent = message;
}

async function fixCalendar() {
    config = {
        username: document.getElementById("githubUsername").value.trim(),
        repo: document.getElementById("githubRepo").value.trim(),
        token: document.getElementById("githubToken").value.trim(),
        branch: document.getElementById("githubBranch").value.trim() || "main"
    };

    if (!config.username || !config.repo || !config.token) {
        showStatus("All fields required", "error");
        return;
    }

    if (!confirm("This will completely regenerate your calendar, removing bad assignments and creating a clean schedule. Continue?")) {
        return;
    }

    try {
        // Step 1: Load current data
        showProgress("Step 1/4: Loading calendar data...");
        const response = await fetch(`https://api.github.com/repos/${config.username}/${config.repo}/contents/noc-calendar-data.json?ref=${config.branch}`, {
            headers: {
                Authorization: `token ${config.token}`,
                Accept: "application/vnd.github.v3+json"
            }
        });

        if (!response.ok) throw new Error("Failed to load data");

        const data = await response.json();
        fileSha = data.sha;
        calendarData = JSON.parse(atob(data.content));

        // Step 2: Clear all rotations
        showProgress("Step 2/4: Clearing old assignments...");
        calendarData.rotation = {};

        // Step 3: Regenerate calendar
        showProgress("Step 3/4: Generating new schedule (75 days)...");
        generateRotation();

        // Step 4: Save
        showProgress("Step 4/4: Saving to GitHub...");
        await saveData();

        // Show results
        showResults();
        showStatus("âœ… Calendar completely fixed! Refresh your NOC viewer to see changes.", "success");

    } catch (error) {
        console.error(error);
        showStatus("Error: " + error.message, "error");
    }
}

function generateRotation() {
    const today = new Date();
    
    const shiftEngineers = {
        early: calendarData.engineers.filter(eng => eng.shift === "early"),
        day: calendarData.engineers.filter(eng => eng.shift === "day"),
        evening: calendarData.engineers.filter(eng => eng.shift === "evening"),
        night: calendarData.engineers.filter(eng => eng.shift === "night")
    };
    
    const rotationIndices = {
        early: {sun: 0, mon: 0, tue: 0, wed: 0, thu: 0, fri: 0, sat: 0},
        day: {sun: 0, mon: 0, tue: 0, wed: 0, thu: 0, fri: 0, sat: 0},
        evening: {sun: 0, mon: 0, tue: 0, wed: 0, thu: 0, fri: 0, sat: 0},
        night: {sun: 0, mon: 0, tue: 0, wed: 0, thu: 0, fri: 0, sat: 0}
    };
    
    for (let dayOffset = 0; dayOffset < 75; dayOffset++) {
        const currentDate = new Date(today);
        currentDate.setDate(currentDate.getDate() + dayOffset);
        
        const dayOfWeek = currentDate.getDay();
        const dayName = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"][dayOfWeek];
        const dateStr = currentDate.toISOString().split("T")[0];
        
        calendarData.rotation[dateStr] = {};
        
        ["night", "early", "day", "evening"].forEach(shiftType => {
            const availableEngineers = shiftEngineers[shiftType].filter(eng => isWorking(eng, dayOfWeek));
            
            if (availableEngineers.length > 0) {
                const engineerIndex = rotationIndices[shiftType][dayName] % availableEngineers.length;
                const selectedEngineer = availableEngineers[engineerIndex];
                
                calendarData.rotation[dateStr][shiftType] = selectedEngineer;
                rotationIndices[shiftType][dayName]++;
            }
        });
    }
}

async function saveData() {
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(calendarData, null, 2))));
    const body = {
        message: "Complete calendar regeneration - all assignments respect days off",
        content: content,
        branch: config.branch,
        sha: fileSha
    };

    const response = await fetch(`https://api.github.com/repos/${config.username}/${config.repo}/contents/noc-calendar-data.json`, {
        method: "PUT",
        headers: {
            Authorization: `token ${config.token}`,
            Accept: "application/vnd.github.v3+json",
            "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
    });

    if (!response.ok) throw new Error("Failed to save data");
    
    const result = await response.json();
    fileSha = result.content.sha;
}

function showResults() {
    const resultsDiv = document.getElementById("results");
    resultsDiv.classList.remove("hidden");
    
    let totalAssignments = 0;
    let unassignedShifts = 0;
    
    for (const dateStr in calendarData.rotation) {
        const shifts = calendarData.rotation[dateStr];
        ["night", "early", "day", "evening"].forEach(shift => {
            if (shifts[shift]) {
                totalAssignments++;
            } else {
                unassignedShifts++;
            }
        });
    }
    
    resultsDiv.innerHTML = `
        <div class="bg-green-50 border-l-4 border-green-400 p-4">
            <p class="text-lg font-bold text-green-800 mb-2">âœ… Calendar Regenerated Successfully!</p>
            <div class="text-sm text-green-700 space-y-1">
                <p>â€¢ Generated 75 days of rotation</p>
                <p>â€¢ ${totalAssignments} shifts assigned</p>
                <p>â€¢ ${unassignedShifts} shifts unassigned (no engineers available those days)</p>
                <p>â€¢ All assignments respect engineer days off</p>
            </div>
        </div>
    `;
    
    document.getElementById("progress").style.display = "none";
}
    </script>
</body>
</html>
