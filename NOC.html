<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOC Incident Rotation Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-cell { min-height: 96px; }
        .calendar-cell:hover { background-color: #dbeafe; }
        .selected-cell { ring: 2px solid #3b82f6; }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .page { display: none; }
        .page.active { display: block; }
        .loading { position: fixed; top: 0; left: 0; right: 0; background: #3b82f6; color: white; padding: 8px; text-align: center; z-index: 100; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loadingBar" class="loading" style="display:none;">Saving changes...</div>
    
    <div class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex gap-4">
                <button onclick="showPage('calendar')" id="navCalendar" class="px-4 py-2 rounded-lg font-semibold transition-colors bg-blue-700">üìÖ Calendar</button>
                <button onclick="showPage('engineers')" id="navEngineers" class="px-4 py-2 rounded-lg font-semibold transition-colors hover:bg-blue-700">üë• Manage Engineers</button>
                <button onclick="showPage('settings')" id="navSettings" class="px-4 py-2 rounded-lg font-semibold transition-colors hover:bg-blue-700">‚öôÔ∏è Settings</button>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-6">GitHub Integration Settings</h1>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <p class="text-sm text-yellow-800"><strong>‚ö†Ô∏è Important:</strong> Enter your GitHub credentials below to enable shared data across all users.</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">GitHub Username:</label>
                        <input type="text" id="githubUsername" placeholder="your-username" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Repository Name:</label>
                        <input type="text" id="githubRepo" placeholder="noc-calendar" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Personal Access Token:</label>
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" class="w-full p-3 border border-gray-300 rounded-lg">
                        <p class="text-xs text-gray-500 mt-1">Token needs 'repo' permissions. <a href="https://github.com/settings/tokens" target="_blank" class="text-blue-600 underline">Create one here</a></p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Branch (usually 'main' or 'gh-pages'):</label>
                        <input type="text" id="githubBranch" placeholder="main" value="main" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    <button onclick="saveGitHubSettings()" class="w-full bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 font-semibold">Save Settings & Initialize</button>
                </div>
                <div id="settingsStatus" class="mt-4"></div>
                <div class="mt-6 text-sm text-gray-600 bg-blue-50 p-4 rounded-lg">
                    <p class="font-semibold mb-2">üìã Setup Instructions:</p>
                    <ol class="list-decimal list-inside space-y-1 ml-2">
                        <li>Create files <code>rotation-data.json</code> and <code>engineers-data.json</code> in your repo (both can start as empty: <code>{}</code> and <code>[]</code>)</li>
                        <li>Generate a Personal Access Token with 'repo' permissions</li>
                        <li>Enter your credentials above and click Save</li>
                        <li>Data will now be shared across all users!</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div id="calendarPage" class="page active">
        <div class="max-w-6xl mx-auto p-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                    <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                        <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        NOC Incident Watch Rotation
                    </h1>
                    <div class="flex items-center gap-4">
                        <button onclick="changeMonth(-1)" id="prevBtn" class="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                        <span id="monthDisplay" class="text-xl font-semibold text-gray-700 min-w-48 text-center"></span>
                        <button onclick="changeMonth(1)" id="nextBtn" class="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                    </div>
                </div>
                <div class="mb-4 flex gap-4 text-xs flex-wrap items-center">
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-indigo-100 border border-indigo-300 rounded"></div><span>üåô Night (00:00-06:00)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-amber-100 border border-amber-300 rounded"></div><span>üåÖ Early (06:00-09:00)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div><span>‚òÄÔ∏è Day (09:00-15:00)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-purple-100 border border-purple-300 rounded"></div><span>üåÜ Evening (15:00-18:00)</span></div>
                    <div class="ml-auto flex gap-2">
                        <button onclick="showRedistributeModal()" class="px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600">üîÑ Redistribute</button>
                        <button onclick="resetRotation()" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Reset</button>
                    </div>
                </div>
                <div class="grid grid-cols-7 gap-0 border border-gray-300 rounded-lg overflow-hidden">
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Sunday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Monday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Tuesday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Wednesday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Thursday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Friday</div>
                    <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Saturday</div>
                    <div id="calendarGrid"></div>
                </div>
                <div id="selectedDetails" class="mt-6 hidden"></div>
            </div>
        </div>
    </div>

    <div id="engineersPage" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Manage Engineers</h1>
                    <button onclick="addEngineer()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">+ Add Engineer</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead><tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2 text-left text-sm font-semibold">Name</th>
                            <th class="border border-gray-300 p-2 text-left text-sm font-semibold">Email</th>
                            <th class="border border-gray-300 p-2 text-left text-sm font-semibold">Shift Type</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Sun</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Mon</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Tue</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Wed</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Thu</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Fri</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Sat</th>
                            <th class="border border-gray-300 p-2 text-center text-sm font-semibold">Actions</th>
                        </tr></thead>
                        <tbody id="engineersTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Edit Shift Assignment</h3>
            <div class="mb-4"><label class="block text-sm font-semibold text-gray-700 mb-2">Date:</label><div id="modalDate" class="text-sm text-gray-600"></div></div>
            <div class="mb-4"><label class="block text-sm font-semibold text-gray-700 mb-2">Shift:</label><div id="modalShift" class="text-sm text-gray-600"></div></div>
            <div class="mb-4"><label class="block text-sm font-semibold text-gray-700 mb-2">Current:</label><div id="modalCurrent" class="text-sm text-gray-600"></div></div>
            <div class="mb-6"><label class="block text-sm font-semibold text-gray-700 mb-2">New Assignment:</label><select id="engineerSelect" class="w-full p-2 border border-gray-300 rounded-lg"></select></div>
            <div class="flex gap-3">
                <button onclick="saveEdit()" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Save</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
            </div>
        </div>
    </div>

    <div id="editEngineerModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Edit Engineer</h3>
            <div class="space-y-4">
                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Name:</label><input type="text" id="editEngName" class="w-full p-2 border border-gray-300 rounded-lg"></div>
                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Email:</label><input type="email" id="editEngEmail" class="w-full p-2 border border-gray-300 rounded-lg"></div>
                <div><label class="block text-sm font-semibold text-gray-700 mb-2">Shift Type:</label><select id="editEngShift" class="w-full p-2 border border-gray-300 rounded-lg"><option value="night">Night</option><option value="early">Early</option><option value="day">Day</option><option value="evening">Evening</option></select></div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Sun:</label><input type="text" id="editEngSun" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Mon:</label><input type="text" id="editEngMon" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Tue:</label><input type="text" id="editEngTue" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Wed:</label><input type="text" id="editEngWed" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Thu:</label><input type="text" id="editEngThu" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Fri:</label><input type="text" id="editEngFri" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">Sat:</label><input type="text" id="editEngSat" placeholder="OFF or HH:MM-HH:MM" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></div>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="saveEngineer()" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Save</button>
                <button onclick="closeEngineerModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
            </div>
        </div>
    </div>

    <div id="redistributeModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Redistribute Shifts</h3>
            <p class="text-sm text-gray-600 mb-4">Auto-generate rotation for date range.</p>
            <div class="mb-4"><label class="block text-sm font-semibold text-gray-700 mb-2">Start:</label><input type="date" id="redistributeStart" class="w-full p-2 border border-gray-300 rounded-lg"></div>
            <div class="mb-6"><label class="block text-sm font-semibold text-gray-700 mb-2">End:</label><input type="date" id="redistributeEnd" class="w-full p-2 border border-gray-300 rounded-lg"></div>
            <div class="flex gap-3">
                <button onclick="redistributeShifts()" class="flex-1 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">Redistribute</button>
                <button onclick="closeRedistributeModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
            </div>
        </div>
    </div>

    <script>
const DEFAULT_ENGINEERS=[{name:"Alexandra Hock",email:"alexandra.hock@ringcentral.com",schedule:{sun:"OFF",mon:"05:00-14:00",tue:"05:00-14:00",wed:"05:00-14:00",thu:"05:00-14:00",fri:"05:00-14:00",sat:"OFF"},shift:"early"},{name:"Marina Stambaugh",email:"marina.stambaugh@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Rochelle Gobis",email:"rochelle.gobis@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"OFF"},shift:"day"},{name:"Sarah Heriford",email:"sarah.heriford@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Karla Talamantes",email:"karla.talamantes@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Jeremy Rodriguez",email:"jeremyr@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Jenny Deasy",email:"jenny.deasy@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-15:30",tue:"07:00-15:30",wed:"07:00-15:30",thu:"07:00-15:30",fri:"07:00-15:30",sat:"OFF"},shift:"early"},{name:"Bo Lemecha",email:"Bo.Lemecha@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-14:30",tue:"06:00-14:30",wed:"06:00-14:30",thu:"06:00-14:30",fri:"06:00-14:30",sat:"OFF"},shift:"early"},{name:"Edwin Reveley",email:"edwin.reveley@ringcentral.com",schedule:{sun:"OFF",mon:"09:30-18:00",tue:"09:30-18:00",wed:"09:30-18:00",thu:"09:30-18:00",fri:"09:30-18:00",sat:"OFF"},shift:"day"},{name:"Edward Salvador",email:"edward.salvador@ringcentral.com",schedule:{sun:"08:00-15:30",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"OFF",sat:"OFF"},shift:"day"},{name:"John Glenn Bayron",email:"john.bayron@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"OFF"},shift:"day"},{name:"Robert Carter",email:"robert.carter@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-17:00",tue:"09:00-17:00",wed:"09:00-17:00",thu:"09:00-17:00",fri:"09:00-17:00",sat:"OFF"},shift:"day"},{name:"Dan Baker",email:"dan.baker1@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-15:00",tue:"07:00-15:00",wed:"07:00-15:00",thu:"07:00-15:00",fri:"07:00-15:00",sat:"OFF"},shift:"early"},{name:"John Tran",email:"john.tran@ringcentral.com",schedule:{sun:"OFF",mon:"10:00-18:00",tue:"10:00-18:00",wed:"10:00-18:00",thu:"10:00-18:00",fri:"10:00-18:00",sat:"OFF"},shift:"day"},{name:"Jared Cooper",email:"jared.cooper@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Lara Mae Dela Cruz",email:"lara.delacruz@ringcentral.com",schedule:{sun:"OFF",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"15:00-00:00",fri:"15:00-00:00",sat:"OFF"},shift:"evening"},{name:"Love Lyn Cano",email:"love.cano@ringcentral.com",schedule:{sun:"15:00-00:00",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"OFF",fri:"OFF",sat:"15:00-00:00"},shift:"evening"},{name:"James Belleza",email:"james.belleza@ringcentral.com",schedule:{sun:"15:00-00:00",mon:"15:00-00:00",tue:"15:00-00:00",wed:"15:00-00:00",thu:"15:00-00:00",fri:"OFF",sat:"OFF"},shift:"evening"},{name:"Rushikesh Sawant",email:"rushikesh.sawant@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Santosh Sahoo",email:"santosh.sahoo@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Srikanth Reddy",email:"srikanth.v@ringcentral.com",schedule:{sun:"22:30-07:30",mon:"22:30-07:30",tue:"22:30-07:30",wed:"22:30-07:30",thu:"22:30-07:30",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Jobon Chinel",email:"jobon.chinel@ringcentral.com",schedule:{sun:"01:00-10:00",mon:"01:00-10:00",tue:"01:00-10:00",wed:"01:00-10:00",thu:"01:00-10:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Ryan Hawkins",email:"ryan.hawkins@ringcentral.com",schedule:{sun:"01:00-07:00",mon:"01:00-07:00",tue:"01:00-07:00",wed:"01:00-07:00",thu:"01:00-07:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Joseph Bendecio",email:"joseph.bendecio@ringcentral.com",schedule:{sun:"OFF",mon:"OFF",tue:"01:00-10:00",wed:"01:00-10:00",thu:"01:00-10:00",fri:"01:00-10:00",sat:"01:00-10:00"},shift:"night"},{name:"Pearce Hamblin",email:"pearce.hamblin@ringcentral.com",schedule:{sun:"01:00-07:00",mon:"01:00-07:00",tue:"01:00-07:00",wed:"01:00-07:00",thu:"01:00-07:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Amine Dahel",email:"amine.dahel@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Andrew Neill",email:"andrew.neill@ringcentral.com",schedule:{sun:"03:00-09:00",mon:"03:00-09:00",tue:"03:00-09:00",wed:"03:00-09:00",thu:"03:00-09:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Andy Connolly",email:"andy.connolly@ringcentral.com",schedule:{sun:"03:00-09:00",mon:"03:00-09:00",tue:"03:00-09:00",wed:"03:00-09:00",thu:"03:00-09:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Colin Finn",email:"colin.finn@ringcentral.com",schedule:{sun:"02:00-08:00",mon:"02:00-08:00",tue:"02:00-08:00",wed:"02:00-08:00",thu:"02:00-08:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Deepthi Chandran",email:"deepthi.chandran@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Derek Walker",email:"derek.walker@ringcentral.com",schedule:{sun:"00:00-06:00",mon:"00:00-06:00",tue:"00:00-06:00",wed:"00:00-06:00",thu:"00:00-06:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Hugo Nickal-Thibeaud",email:"hugo.thibeaud@ringcentral.com",schedule:{sun:"02:00-08:00",mon:"02:00-08:00",tue:"02:00-08:00",wed:"02:00-08:00",thu:"02:00-08:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Baranee Selvendran",email:"baranee.selvendran@ringcentral.com",schedule:{sun:"02:00-10:00",mon:"02:00-10:00",tue:"02:00-10:00",wed:"02:00-10:00",thu:"02:00-10:00",fri:"OFF",sat:"OFF"},shift:"night"},{name:"Eryll Azucena",email:"eryll.azucena@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-15:30",tue:"08:00-15:30",wed:"08:00-15:30",thu:"08:00-15:30",fri:"08:00-15:30",sat:"08:00-15:30"},shift:"day"},{name:"Mare Snyder",email:"mare.snyder@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Nate Malone",email:"nate.malone@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Peter Czarnecki",email:"peter.czarnecki@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-14:30",tue:"06:00-14:30",wed:"06:00-14:30",thu:"06:00-14:30",fri:"06:00-14:30",sat:"OFF"},shift:"early"},{name:"Colby Jestes",email:"colby.jestes@ringcentral.com",schedule:{sun:"OFF",mon:"08:00-16:30",tue:"08:00-16:30",wed:"08:00-16:30",thu:"08:00-16:30",fri:"08:00-16:30",sat:"OFF"},shift:"day"},{name:"Mark Peirce",email:"mark.peirce@ringcentral.com",schedule:{sun:"OFF",mon:"09:00-18:00",tue:"09:00-18:00",wed:"09:00-18:00",thu:"09:00-18:00",fri:"09:00-18:00",sat:"OFF"},shift:"day"},{name:"Roscoe Bryant",email:"roscoe.bryant@ringcentral.com",schedule:{sun:"OFF",mon:"08:30-17:00",tue:"08:30-17:00",wed:"08:30-17:00",thu:"08:30-17:00",fri:"08:30-17:00",sat:"OFF"},shift:"day"},{name:"Cindy Hubert",email:"cindy.hubert@ringcentral.com",schedule:{sun:"OFF",mon:"07:00-16:00",tue:"07:00-16:00",wed:"07:00-16:00",thu:"07:00-16:00",fri:"07:00-16:00",sat:"OFF"},shift:"early"},{name:"Abby Bearden",email:"abby.bearden@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-15:00",tue:"06:00-15:00",wed:"06:00-15:00",thu:"06:00-15:00",fri:"06:00-15:00",sat:"OFF"},shift:"early"},{name:"Tim Arnott",email:"tim.arnott@ringcentral.com",schedule:{sun:"OFF",mon:"06:00-15:00",tue:"06:00-15:00",wed:"06:00-15:00",thu:"06:00-15:00",fri:"06:00-15:00",sat:"OFF"},shift:"early"},{name:"Tomislav Vranjes",email:"tomislav.vranjes@ringcentral.com",schedule:{sun:"OFF",mon:"09:30-18:00",tue:"09:30-18:00",wed:"09:30-18:00",thu:"09:30-18:00",fri:"09:30-18:00",sat:"OFF"},shift:"day"}];
let engineers=[...DEFAULT_ENGINEERS];let currentMonth=0,selectedDate=null,rotation={},editingDate=null,editingShift=null,editingEngineerIndex=null,githubConfig={username:"",repo:"",token:"",branch:"main"},fileShas={rotation:"",engineers:""};function showLoading(){document.getElementById("loadingBar").style.display="block"}function hideLoading(){document.getElementById("loadingBar").style.display="none"}function showPage(e){document.querySelectorAll(".page").forEach(e=>e.classList.remove("active")),document.querySelectorAll("[id^=nav]").forEach(e=>{e.classList.remove("bg-blue-700"),e.classList.add("hover:bg-blue-700")}),"calendar"===e?(document.getElementById("calendarPage").classList.add("active"),document.getElementById("navCalendar").classList.add("bg-blue-700")):"engineers"===e?(document.getElementById("engineersPage").classList.add("active"),document.getElementById("navEngineers").classList.add("bg-blue-700"),renderEngineersTable()):"settings"===e&&(document.getElementById("settingsPage").classList.add("active"),document.getElementById("navSettings").classList.add("bg-blue-700"),loadGitHubSettings())}function loadGitHubSettings(){const e=localStorage.getItem("githubConfig");e&&(githubConfig=JSON.parse(e),document.getElementById("githubUsername").value=githubConfig.username,document.getElementById("githubRepo").value=githubConfig.repo,document.getElementById("githubToken").value=githubConfig.token,document.getElementById("githubBranch").value=githubConfig.branch||"main")}async function saveGitHubSettings(){const e=document.getElementById("githubUsername").value.trim(),t=document.getElementById("githubRepo").value.trim(),a=document.getElementById("githubToken").value.trim(),n=document.getElementById("githubBranch").value.trim()||"main";if(!e||!t||!a)return void showStatus("Please fill in all fields","error");githubConfig={username:e,repo:t,token:a,branch:n},localStorage.setItem("githubConfig",JSON.stringify(githubConfig)),showStatus("Settings saved! Testing connection...","info");try{await loadFromGitHub(),showStatus("‚úÖ Connected successfully! Data loaded.","success"),setTimeout(()=>{showPage("calendar")},2e3)}catch(e){showStatus("‚ö†Ô∏è Settings saved but couldn't load data. Make sure files exist in repo.","warning")}}function showStatus(e,t){const a=document.getElementById("settingsStatus"),n={success:"bg-green-50 text-green-800 border-green-200",error:"bg-red-50 text-red-800 border-red-200",warning:"bg-yellow-50 text-yellow-800 border-yellow-200",info:"bg-blue-50 text-blue-800 border-blue-200"};a.className=`p-4 rounded-lg border ${n[t]}`,a.textContent=e}async function loadFromGitHub(){if(!githubConfig.token)return;showLoading();try{const e=await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/rotation-data.json?ref=${githubConfig.branch}`,{headers:{Authorization:`token ${githubConfig.token}`,Accept:"application/vnd.github.v3+json"}});if(e.ok){const t=await e.json();fileShas.rotation=t.sha;const a=JSON.parse(atob(t.content));rotation=a}const t=await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/engineers-data.json?ref=${githubConfig.branch}`,{headers:{Authorization:`token ${githubConfig.token}`,Accept:"application/vnd.github.v3+json"}});if(t.ok){const e=await t.json();fileShas.engineers=e.sha;const a=JSON.parse(atob(e.content));a.length>0&&(engineers=a)}renderCalendar(),renderEngineersTable()}catch(e){console.error("Error loading from GitHub:",e)}finally{hideLoading()}}async function saveToGitHub(e,t,a){if(!githubConfig.token)return;showLoading();try{const n=btoa(unescape(encodeURIComponent(JSON.stringify(t,null,2)))),r={message:`Update ${e}`,content:n,branch:githubConfig.branch};a&&(r.sha=a);await fetch(`https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${e}`,{method:"PUT",headers:{Authorization:`token ${githubConfig.token}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){console.error("Error saving to GitHub:",e),alert("Error saving to GitHub. Check console.")}finally{hideLoading()}}function renderEngineersTable(){const e=document.getElementById("engineersTable");e.innerHTML="",engineers.forEach((t,a)=>{const n=document.createElement("tr");n.innerHTML=`<td class="border border-gray-300 p-2 text-sm">${t.name}</td><td class="border border-gray-300 p-2 text-sm">${t.email}</td><td class="border border-gray-300 p-2 text-sm">${t.shift}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.sun}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.mon}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.tue}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.wed}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.thu}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.fri}</td><td class="border border-gray-300 p-2 text-xs text-center">${t.schedule.sat}</td><td class="border border-gray-300 p-2 text-center"><button onclick="editEngineer(${a})" class="px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 mr-1">Edit</button><button onclick="deleteEngineer(${a})" class="px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Del</button></td>`,e.appendChild(n)})}function addEngineer(){editingEngineerIndex=-1,document.getElementById("editEngName").value="",document.getElementById("editEngEmail").value="",document.getElementById("editEngShift").value="day",document.getElementById("editEngSun").value="OFF",document.getElementById("editEngMon").value="08:00-17:00",document.getElementById("editEngTue").value="08:00-17:00",document.getElementById("editEngWed").value="08:00-17:00",document.getElementById("editEngThu").value="08:00-17:00",document.getElementById("editEngFri").value="08:00-17:00",document.getElementById("editEngSat").value="OFF",document.getElementById("editEngineerModal").classList.add("show")}function editEngineer(e){editingEngineerIndex=e;const t=engineers[e];document.getElementById("editEngName").value=t.name,document.getElementById("editEngEmail").value=t.email,document.getElementById("editEngShift").value=t.shift,document.getElementById("editEngSun").value=t.schedule.sun,document.getElementById("editEngMon").value=t.schedule.mon,document.getElementById("editEngTue").value=t.schedule.tue,document.getElementById("editEngWed").value=t.schedule.wed,document.getElementById("editEngThu").value=t.schedule.thu,document.getElementById("editEngFri").value=t.schedule.fri,document.getElementById("editEngSat").value=t.schedule.sat,document.getElementById("editEngineerModal").classList.add("show")}async function saveEngineer(){const e={name:document.getElementById("editEngName").value.trim(),email:document.getElementById("editEngEmail").value.trim(),shift:document.getElementById("editEngShift").value,schedule:{sun:document.getElementById("editEngSun").value.trim(),mon:document.getElementById("editEngMon").value.trim(),tue:document.getElementById("editEngTue").value.trim(),wed:document.getElementById("editEngWed").value.trim(),thu:document.getElementById("editEngThu").value.trim(),fri:document.getElementById("editEngFri").value.trim(),sat:document.getElementById("editEngSat").value.trim()}};e.name&&e.email?(-1===editingEngineerIndex?engineers.push(e):engineers[editingEngineerIndex]=e,await saveToGitHub("engineers-data.json",engineers,fileShas.engineers),closeEngineerModal(),renderEngineersTable()):alert("Name and email required")}async function deleteEngineer(e){confirm(`Delete ${engineers[e].name}?`)&&(engineers.splice(e,1),await saveToGitHub("engineers-data.json",engineers,fileShas.engineers),renderEngineersTable())}function closeEngineerModal(){document.getElementById("editEngineerModal").classList.remove("show"),editingEngineerIndex=null}function showRedistributeModal(){const e=new Date;document.getElementById("redistributeStart").value=e.toISOString().split("T")[0];const t=new Date(e);t.setDate(t.getDate()+30),document.getElementById("redistributeEnd").value=t.toISOString().split("T")[0],document.getElementById("redistributeModal").classList.add("show")}function closeRedistributeModal(){document.getElementById("redistributeModal").classList.remove("show")}async function redistributeShifts(){const e=document.getElementById("redistributeStart").value,t=document.getElementById("redistributeEnd").value;if(!e||!t)return void alert("Select both dates");const a=new Date(e),n=new Date(t);if(a>n)return void alert("Start must be before end");if(confirm("Redistribute all shifts in range?")){const e={early:engineers.filter(e=>"early"===e.shift),day:engineers.filter(e=>"day"===e.shift),evening:engineers.filter(e=>"evening"===e.shift),night:engineers.filter(e=>"night"===e.shift)},t={early:0,day:0,evening:0,night:0};let r=new Date(a);for(;r<=n;){const a=r.getDay(),n=r.toISOString().split("T")[0];rotation[n]||(rotation[n]={}),Object.keys(e).forEach(s=>{const i=e[s].filter(e=>isWorking(e,a));if(i.length>0){const e=i[t[s]%i.length];rotation[n][s]=e,t[s]++}}),r.setDate(r.getDate()+1)}await saveToGitHub("rotation-data.json",rotation,fileShas.rotation),closeRedistributeModal(),renderCalendar(),alert("Shifts redistributed!")}}function isWorking(e,t){return"OFF"!==e.schedule[["sun","mon","tue","wed","thu","fri","sat"][t]]}function generateRotation(){const e=new Date(2025,10,18),t={early:engineers.filter(e=>"early"===e.shift),day:engineers.filter(e=>"day"===e.shift),evening:engineers.filter(e=>"evening"===e.shift),night:engineers.filter(e=>"night"===e.shift)},a={early:0,day:0,evening:0,night:0};for(let n=0;n<75;n++){const r=new Date(e);r.setDate(r.getDate()+n);const s=r.getDay(),i=r.toISOString().split("T")[0];rotation[i]={},Object.keys(t).forEach(e=>{const n=t[e].filter(e=>isWorking(e,s));if(n.length>0){const t=n[a[e]%n.length];rotation[i][e]=t,a[e]++}})}}async function resetRotation(){confirm("Reset to default?")&&(generateRotation(),await saveToGitHub("rotation-data.json",rotation,fileShas.rotation),renderCalendar(),selectedDate&&showDateDetails(selectedDate))}function getCalendarData(){const e=new Date(2025,10,1);e.setMonth(e.getMonth()+currentMonth);const t=e.getFullYear(),a=e.getMonth(),n=new Date(t,a,1),r=(new Date(t,a+1,0).getDate(),n.getDay());return{monthName:["January","February","March","April","May","June","July","August","September","October","November","December"][a],year:t,daysInMonth:new Date(t,a+1,0).getDate(),startingDayOfWeek:r,month:a}}function renderCalendar(){const e=getCalendarData(),t=document.getElementById("calendarGrid");t.innerHTML="",t.className="col-span-7 grid grid-cols-7";for(let a=0;a<e.startingDayOfWeek;a++){const e=document.createElement("div");e.className="p-2 border border-gray-100",t.appendChild(e)}for(let a=1;a<=e.daysInMonth;a++){const n=new Date(e.year,e.month,a),r=n.toISOString().split("T")[0],s=rotation[r]||{},i="2025-11-18"===r,o=document.createElement("div");o.className=`calendar-cell p-2 border border-gray-200 cursor-pointer transition-colors ${i?"bg-blue-100 border-blue-400":""} ${selectedDate===r?"selected-cell":""}`,o.onclick=()=>selectDate(r);let l=`<div class="font-semibold text-sm mb-1 ${i?"text-blue-700":"text-gray-700"}">${a}</div>`;l+='<div class="text-xs space-y-1">',s.night&&(l+=`<div class="bg-indigo-100 text-indigo-800 px-1 py-0.5 rounded truncate">üåô ${s.night.name.split(" ")[0]}</div>`),s.early&&(l+=`<div class="bg-amber-100 text-amber-800 px-1 py-0.5 rounded truncate">üåÖ ${s.early.name.split(" ")[0]}</div>`),s.day&&(l+=`<div class="bg-green-100 text-green-800 px-1 py-0.5 rounded truncate">‚òÄÔ∏è ${s.day.name.split(" ")[0]}</div>`),s.evening&&(l+=`<div class="bg-purple-100 text-purple-800 px-1 py-0.5 rounded truncate">üåÜ ${s.evening.name.split(" ")[0]}</div>`),l+="</div>",o.innerHTML=l,t.appendChild(o)}document.getElementById("monthDisplay").textContent=`${e.monthName} ${e.year}`,updateButtons()}function selectDate(e){selectedDate=e,renderCalendar(),showDateDetails(e)}function showDateDetails(e){const t=rotation[e]||{},a=new Date(e),n=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=a.getDay(),s=["sun","mon","tue","wed","thu","fri","sat"],i=document.getElementById("selectedDetails");i.className="mt-6 bg-white border-2 border-blue-200 rounded-lg p-4 shadow-lg";let o='<h3 class="text-lg font-bold text-gray-800 mb-3">'+n+'</h3><div class="space-y-3">';t.night&&(o+=`<div class="border-l-4 border-indigo-500 pl-3 py-2 bg-indigo-50 rounded"><div class="flex justify-between items-start"><div class="flex-1"><div class="font-semibold text-indigo-900">üåô Night (00:00-06:00)</div><div class="text-sm text-indigo-800">${t.night.name}</div><div class="text-xs text-indigo-600">${t.night.email}</div><div class="text-xs text-indigo-700 mt-1">Hours: ${t.night.schedule[s[r]]}</div></div><button onclick="editAssignment('${e}','night')" class="ml-2 px-2 py-1 text-xs bg-indigo-500 text-white rounded hover:bg-indigo-600">Edit</button></div></div>`),t.early&&(o+=`<div class="border-l-4 border-amber-500 pl-3 py-2 bg-amber-50 rounded"><div class="flex justify-between items-start"><div class="flex-1"><div class="font-semibold text-amber-900">üåÖ Early (06:00-09:00)</div><div class="text-sm text-amber-800">${t.early.name}</div><div class="text-xs text-amber-600">${t.early.email}</div><div class="text-xs text-amber-700 mt-1">Hours: ${t.early.schedule[s[r]]}</div></div><button onclick="editAssignment('${e}','early')" class="ml-2 px-2 py-1 text-xs bg-amber-500 text-white rounded hover:bg-amber-600">Edit</button></div></div>`),t.day&&(o+=`<div class="border-l-4 border-green-500 pl-3 py-2 bg-green-50 rounded"><div class="flex justify-between items-start"><div class="flex-1"><div class="font-semibold text-green-900">‚òÄÔ∏è Day (09:00-15:00)</div><div class="text-sm text-green-800">${t.day.name}</div><div class="text-xs text-green-600">${t.day.email}</div><div class="text-xs text-green-700 mt-1">Hours: ${t.day.schedule[s[r]]}</div></div><button onclick="editAssignment('${e}','day')" class="ml-2 px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600">Edit</button></div></div>`),t.evening&&(o+=`<div class="border-l-4 border-purple-500 pl-3 py-2 bg-purple-50 rounded"><div class="flex justify-between items-start"><div class="flex-1"><div class="font-semibold text-purple-900">üåÜ Evening (15:00-18:00)</div><div class="text-sm text-purple-800">${t.evening.name}</div><div class="text-xs text-purple-600">${t.evening.email}</div><div class="text-xs text-purple-700 mt-1">Hours: ${t.evening.schedule[s[r]]}</div></div><button onclick="editAssignment('${e}','evening')" class="ml-2 px-2 py-1 text-xs bg-purple-500 text-white rounded hover:bg-purple-600">Edit</button></div></div>`),o+="</div>",i.innerHTML=o}function editAssignment(e,t){editingDate=e,editingShift=t;const a=new Date(e),n=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=a.getDay(),s=rotation[e][t],i={night:"üåô Night (00:00-06:00)",early:"üåÖ Early (06:00-09:00)",day:"‚òÄÔ∏è Day (09:00-15:00)",evening:"üåÜ Evening (15:00-18:00)"};document.getElementById("modalDate").textContent=n,document.getElementById("modalShift").textContent=i[t],document.getElementById("modalCurrent").textContent=`${s.name} (${s.email})`;const o=engineers.filter(e=>e.shift===t&&isWorking(e,r)),l=document.getElementById("engineerSelect");l.innerHTML="",o.forEach(e=>{const t=document.createElement("option");t.value=e.email,t.textContent=`${e.name} (${e.email})`,e.email===s.email&&(t.selected=!0),l.appendChild(t)}),document.getElementById("editModal").classList.add("show")}function closeModal(){document.getElementById("editModal").classList.remove("show"),editingDate=null,editingShift=null}async function saveEdit(){const e=document.getElementById("engineerSelect").value,t=engineers.find(t=>t.email===e);t&&editingDate&&editingShift&&(rotation[editingDate][editingShift]=t,await saveToGitHub("rotation-data.json",rotation,fileShas.rotation),closeModal(),renderCalendar(),showDateDetails(editingDate))}function changeMonth(e){const t=currentMonth+e;t>=0&&t<=2&&(currentMonth=t,selectedDate=null,document.getElementById("selectedDetails").className="mt-6 hidden",renderCalendar())}function updateButtons(){document.getElementById("prevBtn").disabled=0===currentMonth,document.getElementById("nextBtn").disabled=2===currentMonth,0===currentMonth?document.getElementById("prevBtn").className="p-2 rounded-lg bg-gray-300 text-white cursor-not-allowed":document.getElementById("prevBtn").className="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600",2===currentMonth?document.getElementById("nextBtn").className="p-2 rounded-lg bg-gray-300 text-white cursor-not-allowed":document.getElementById("nextBtn").className="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"}loadGitHubSettings(),githubConfig.token?(loadFromGitHub(),renderCalendar()):(generateRotation(),renderCalendar());
    </script>
</body>
</html>
