<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOC Incident Rotation Calendar - Fixed 24hr Coverage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-cell { min-height: 96px; }
        .calendar-cell:hover { background-color: #dbeafe; }
        .selected-cell { ring: 2px solid #3b82f6; }
        .loading { position: fixed; top: 0; left: 0; right: 0; background: #3b82f6; color: white; padding: 8px; text-align: center; z-index: 100; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loadingBar" class="loading" style="display:none;">Loading data...</div>
    
    <div class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <h1 class="text-xl font-bold">üìÖ NOC Incident Watch Rotation - View Only</h1>
            <p class="text-sm text-blue-100 mt-1">Read-only view ‚Ä¢ Updates automatically from GitHub</p>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    NOC Incident Watch Rotation
                </h2>
                <div class="flex items-center gap-4">
                    <button onclick="changeMonth(-1)" id="prevBtn" class="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <span id="monthDisplay" class="text-xl font-semibold text-gray-700 min-w-48 text-center"></span>
                    <button onclick="changeMonth(1)" id="nextBtn" class="p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
            </div>
            
            <div id="errorMessage" class="mb-4 hidden bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <p class="text-sm text-yellow-800">Could not load data from GitHub. Make sure the admin has configured the calendar properly.</p>
            </div>

            <div class="mb-4 flex gap-4 text-xs flex-wrap items-center">
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-indigo-100 border border-indigo-300 rounded"></div><span>üåô Night (00:00-06:00)</span></div>
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-amber-100 border border-amber-300 rounded"></div><span>üåÖ Early (06:00-09:00)</span></div>
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div><span>‚òÄÔ∏è Day (09:00-15:00)</span></div>
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-purple-100 border border-purple-300 rounded"></div><span>üåÜ Evening (15:00-00:00)</span></div>
                <button onclick="loadData()" class="ml-auto px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600">üîÑ Refresh</button>
            </div>

            <div class="grid grid-cols-7 gap-0 border border-gray-300 rounded-lg overflow-hidden">
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Sunday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Monday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Tuesday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Wednesday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Thursday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Friday</div>
                <div class="bg-gray-100 p-2 text-center font-semibold text-sm text-gray-700 border-b border-gray-300">Saturday</div>
                <div id="calendarGrid"></div>
            </div>

            <div id="selectedDetails" class="mt-6 hidden"></div>
            
            <div class="mt-6 text-sm text-gray-600 bg-blue-50 p-4 rounded-lg">
                <p class="font-semibold mb-2">‚ÑπÔ∏è About This Calendar:</p>
                <ul class="list-disc list-inside space-y-1 ml-2">
                    <li>This is a <strong>read-only view</strong> of the NOC incident rotation</li>
                    <li>Click any date to see full shift assignments and contact information</li>
                    <li>Data updates automatically from GitHub</li>
                    <li>To make changes, contact your administrator</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
// Configuration - UPDATE THESE VALUES
const GITHUB_USERNAME = 'dher405';
const GITHUB_REPO = 'Work';
const GITHUB_BRANCH = 'main';
const DATA_FILE = 'noc-calendar-data.json';

let currentMonth = 0;
let selectedDate = null;
let calendarData = { rotation: {}, engineers: [] };

function showLoading() { document.getElementById('loadingBar').style.display = 'block'; }
function hideLoading() { document.getElementById('loadingBar').style.display = 'none'; }

async function loadData() {
    showLoading();
    try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${DATA_FILE}?ref=${GITHUB_BRANCH}`);
        if (response.ok) {
            const data = await response.json();
            calendarData = JSON.parse(atob(data.content));
            document.getElementById('errorMessage').classList.add('hidden');
            renderCalendar();
        } else {
            document.getElementById('errorMessage').classList.remove('hidden');
        }
    } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('errorMessage').classList.remove('hidden');
    } finally {
        hideLoading();
    }
}

function getCalendarData() {
    const baseDate = new Date(2025, 10, 1);
    baseDate.setMonth(baseDate.getMonth() + currentMonth);
    const year = baseDate.getFullYear();
    const month = baseDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const startingDayOfWeek = firstDay.getDay();
    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    return { monthName: monthNames[month], year, daysInMonth, startingDayOfWeek, month };
}

function renderCalendar() {
    const cal = getCalendarData();
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    grid.className = 'col-span-7 grid grid-cols-7';

    for (let i = 0; i < cal.startingDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'p-2 border border-gray-100';
        grid.appendChild(emptyCell);
    }

    for (let day = 1; day <= cal.daysInMonth; day++) {
        const date = new Date(cal.year, cal.month, day);
        const dateKey = date.toISOString().split('T')[0];
        const assignments = calendarData.rotation[dateKey] || {};
        const isToday = dateKey === new Date().toISOString().split('T')[0];

        const cell = document.createElement('div');
        cell.className = `calendar-cell p-2 border border-gray-200 cursor-pointer transition-colors ${isToday ? 'bg-blue-100 border-blue-400' : ''} ${selectedDate === dateKey ? 'selected-cell' : ''}`;
        cell.onclick = () => selectDate(dateKey);

        let html = `<div class="font-semibold text-sm mb-1 ${isToday ? 'text-blue-700' : 'text-gray-700'}">${day}</div><div class="text-xs space-y-1">`;
        if (assignments.night) html += `<div class="bg-indigo-100 text-indigo-800 px-1 py-0.5 rounded truncate">üåô ${assignments.night.name.split(' ')[0]}</div>`;
        if (assignments.early) html += `<div class="bg-amber-100 text-amber-800 px-1 py-0.5 rounded truncate">üåÖ ${assignments.early.name.split(' ')[0]}</div>`;
        if (assignments.day) html += `<div class="bg-green-100 text-green-800 px-1 py-0.5 rounded truncate">‚òÄÔ∏è ${assignments.day.name.split(' ')[0]}</div>`;
        if (assignments.evening) html += `<div class="bg-purple-100 text-purple-800 px-1 py-0.5 rounded truncate">üåÜ ${assignments.evening.name.split(' ')[0]}</div>`;
        html += '</div>';
        cell.innerHTML = html;
        grid.appendChild(cell);
    }

    document.getElementById('monthDisplay').textContent = `${cal.monthName} ${cal.year}`;
    updateButtons();
}

function selectDate(dateKey) {
    selectedDate = dateKey;
    renderCalendar();
    showDateDetails(dateKey);
}

function showDateDetails(dateKey) {
    const assignments = calendarData.rotation[dateKey] || {};
    const [year, month, day] = dateKey.split('-').map(Number);
    const date = new Date(year, month - 1, day);
    const dateString = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    const dayOfWeek = date.getDay();
    const days = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];

    const detailsDiv = document.getElementById('selectedDetails');
    detailsDiv.className = 'mt-6 bg-white border-2 border-blue-200 rounded-lg p-4 shadow-lg';
    
    let html = `<h3 class="text-lg font-bold text-gray-800 mb-3">${dateString}</h3><div class="space-y-3">`;

    if (assignments.night) {
        const eng = assignments.night;
        html += `<div class="border-l-4 border-indigo-500 pl-3 py-2 bg-indigo-50 rounded">
            <div class="font-semibold text-indigo-900">üåô Night Shift (00:00-06:00)</div>
            <div class="text-sm text-indigo-800">${eng.name}</div>
            <div class="text-xs text-indigo-600">${eng.email}</div>
            <div class="text-xs text-indigo-700 mt-1">Hours: ${eng.schedule[days[dayOfWeek]]}</div>
        </div>`;
    }
    if (assignments.early) {
        const eng = assignments.early;
        html += `<div class="border-l-4 border-amber-500 pl-3 py-2 bg-amber-50 rounded">
            <div class="font-semibold text-amber-900">üåÖ Early Shift (06:00-09:00)</div>
            <div class="text-sm text-amber-800">${eng.name}</div>
            <div class="text-xs text-amber-600">${eng.email}</div>
            <div class="text-xs text-amber-700 mt-1">Hours: ${eng.schedule[days[dayOfWeek]]}</div>
        </div>`;
    }
    if (assignments.day) {
        const eng = assignments.day;
        html += `<div class="border-l-4 border-green-500 pl-3 py-2 bg-green-50 rounded">
            <div class="font-semibold text-green-900">‚òÄÔ∏è Day Shift (09:00-15:00)</div>
            <div class="text-sm text-green-800">${eng.name}</div>
            <div class="text-xs text-green-600">${eng.email}</div>
            <div class="text-xs text-green-700 mt-1">Hours: ${eng.schedule[days[dayOfWeek]]}</div>
        </div>`;
    }
    if (assignments.evening) {
        const eng = assignments.evening;
        html += `<div class="border-l-4 border-purple-500 pl-3 py-2 bg-purple-50 rounded">
            <div class="font-semibold text-purple-900">üåÜ Evening Shift (15:00-00:00)</div>
            <div class="text-sm text-purple-800">${eng.name}</div>
            <div class="text-xs text-purple-600">${eng.email}</div>
            <div class="text-xs text-purple-700 mt-1">Hours: ${eng.schedule[days[dayOfWeek]]}</div>
        </div>`;
    }

    html += '</div>';
    detailsDiv.innerHTML = html;
}

function changeMonth(delta) {
    const newMonth = currentMonth + delta;
    if (newMonth >= 0 && newMonth <= 2) {
        currentMonth = newMonth;
        selectedDate = null;
        document.getElementById('selectedDetails').className = 'mt-6 hidden';
        renderCalendar();
    }
}

function updateButtons() {
    document.getElementById('prevBtn').disabled = currentMonth === 0;
    document.getElementById('nextBtn').disabled = currentMonth === 2;
    if (currentMonth === 0) {
        document.getElementById('prevBtn').className = 'p-2 rounded-lg bg-gray-300 text-white cursor-not-allowed';
    } else {
        document.getElementById('prevBtn').className = 'p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600';
    }
    if (currentMonth === 2) {
        document.getElementById('nextBtn').className = 'p-2 rounded-lg bg-gray-300 text-white cursor-not-allowed';
    } else {
        document.getElementById('nextBtn').className = 'p-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600';
    }
}

// Auto-refresh every 60 seconds
setInterval(loadData, 60000);

// Initial load
loadData();
    </script>
</body>
</html>
